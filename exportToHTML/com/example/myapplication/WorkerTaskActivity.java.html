<html>
<head>
<title>WorkerTaskActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #008000; font-weight: bold;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
WorkerTaskActivity.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span>com.example.myapplication;

<span class="s0">import </span>androidx.appcompat.app.AppCompatActivity;
<span class="s0">import </span>androidx.recyclerview.widget.LinearLayoutManager;
<span class="s0">import </span>androidx.recyclerview.widget.RecyclerView;

<span class="s0">import </span>android.graphics.Color;
<span class="s0">import </span>android.os.AsyncTask;
<span class="s0">import </span>android.os.Bundle;
<span class="s0">import </span>android.util.Log;

<span class="s0">import </span>com.google.android.material.card.MaterialCardView;

<span class="s0">import </span>java.sql.Connection;
<span class="s0">import </span>java.sql.ResultSet;
<span class="s0">import </span>java.sql.SQLException;
<span class="s0">import </span>java.sql.Statement;
<span class="s0">import </span>java.util.ArrayList;

<span class="s0">public class </span>WorkerTaskActivity <span class="s0">extends </span>AppCompatActivity {

    ArrayList&lt;Task&gt; taskArrayList;
    WorkerTaskAdapter workerTaskAdapter;
    RecyclerView recyclerView;
    LinearLayoutManager linearLayoutManager;
    SqlConnection connection;
    Connection con;

    @Override
    <span class="s0">protected void </span>onPause() {
        <span class="s0">super</span>.onPause();
        taskArrayList.clear();
    }

    @Override
    <span class="s0">protected void </span>onCreate(Bundle savedInstanceState) {
        <span class="s0">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_worker_task);
        getWindow().setStatusBarColor(Color.parseColor(<span class="s2">&quot;#03a9f4&quot;</span>));
        recyclerView = findViewById(R.id.recycler_view);
        taskArrayList = <span class="s0">new </span>ArrayList&lt;&gt;();
        connection = <span class="s0">new </span>SqlConnection();
        linearLayoutManager = <span class="s0">new </span>LinearLayoutManager(getApplicationContext());
        recyclerView.setLayoutManager(linearLayoutManager);
        workerTaskAdapter = <span class="s0">new </span>WorkerTaskAdapter(getApplicationContext(), taskArrayList);
        recyclerView.setAdapter(workerTaskAdapter);
    }

    @Override
    <span class="s0">protected void </span>onPostResume() {
        <span class="s0">super</span>.onPostResume();
        taskArrayList.clear();
        <span class="s0">new </span>getTasks().execute();
    }

    <span class="s0">public class </span>getTasks <span class="s0">extends </span>AsyncTask&lt;Void, Void, Void&gt; {



        @Override
        <span class="s0">protected void </span>onPostExecute(Void voids) {
            <span class="s0">super</span>.onPostExecute(voids);
          workerTaskAdapter.notifyDataSetChanged();


        }

        <span class="s0">protected </span>Void doInBackground(Void... voids) {
          taskArrayList.clear();
             con = connection.CONN();
            <span class="s0">if </span>(con != <span class="s0">null</span>) {
                Statement statement = <span class="s0">null</span>;
                <span class="s0">try </span>{
                    statement = con.createStatement();
                } <span class="s0">catch </span>(SQLException e) {
                    e.printStackTrace();
                }

                ResultSet rs = <span class="s0">null</span>;
                <span class="s0">try </span>{
                    rs = statement.executeQuery(<span class="s2">&quot;select</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;CZN_NrPelny as [Numer Zlecenia]</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;,ZZs_PrcID as [Id Pracownika]</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;, (select top 1 CZ_Kod from dbo.CtiZasob where CZ_ID = ZZs_CZID) as [Nazwa Zasobu]</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;, ZZs_DataOd as [Start]</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;, (select top 1 PRE_Imie1 + ' ' + PRE_Nazwisko from CDN.PracEtaty where PRE_PraId = ZZs_PrcId) as [Pracownik Rzeczywisty]</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;, (DATEDIFF(SECOND, ZZs_DataOd, CASE WHEN ZZs_DataDo IS NULL THEN getdate() END)/60.0000) as [Czas - Zadania TrwajÄ…ce w minutach ]</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;from dbo.CtiZlecenieNag</span><span class="s0">\n</span><span class="s2">&quot; </span>+
                            <span class="s2">&quot;right join dbo.CtiZlecenieZasob on CZN_ID = ZZs_CZNID where ZZs_DataDo is NULL&quot;</span>);
                    <span class="s0">while </span>(rs.next()) {
                        <span class="s0">int </span>workerId = rs.getInt(<span class="s2">&quot;Id Pracownika&quot;</span>);
                        String name = rs.getString(<span class="s2">&quot;Pracownik Rzeczywisty&quot;</span>);
                        String resource = rs.getString(<span class="s2">&quot;Nazwa Zasobu&quot;</span>);
                        String number = rs.getString(<span class="s2">&quot;Numer Zlecenia&quot;</span>);
                        String startDate = rs.getString(<span class="s2">&quot;Start&quot;</span>).toString();
                        taskArrayList.add(<span class="s0">new </span>Task(workerId, name, resource, number, startDate));
                    }

                    con.close();
                } <span class="s0">catch </span>(SQLException e) {
                    e.printStackTrace();
                }
            }
            <span class="s0">return null</span>;
        }

        @Override
        <span class="s0">protected void </span>onPreExecute() {
            <span class="s0">super</span>.onPreExecute();
            taskArrayList.clear();
        }
    }
}













</pre>
</body>
</html>