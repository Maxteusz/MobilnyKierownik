<html>
<head>
<title>MenuActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #0000ff;}
.s3 { color: #008000; font-weight: bold;}
.s4 { color: #808080; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
MenuActivity.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span>com.example.myapplication;

<span class="s0">import </span>android.annotation.SuppressLint;
<span class="s0">import </span>android.app.Activity;
<span class="s0">import </span>android.app.Dialog;
<span class="s0">import </span>android.content.Context;
<span class="s0">import </span>android.content.Intent;
<span class="s0">import </span>android.content.SharedPreferences;
<span class="s0">import </span>android.graphics.Color;
<span class="s0">import </span>android.graphics.drawable.ColorDrawable;
<span class="s0">import </span>android.os.AsyncTask;
<span class="s0">import </span>android.os.Build;
<span class="s0">import </span>android.os.Bundle;
<span class="s0">import </span>android.util.Log;
<span class="s0">import </span>android.view.MenuItem;
<span class="s0">import </span>android.view.MotionEvent;
<span class="s0">import </span>android.view.View;
<span class="s0">import </span>android.view.Window;
<span class="s0">import </span>android.view.WindowManager;
<span class="s0">import </span>android.widget.AdapterView;
<span class="s0">import </span>android.widget.ArrayAdapter;
<span class="s0">import </span>android.widget.AutoCompleteTextView;
<span class="s0">import </span>android.widget.EditText;
<span class="s0">import </span>android.widget.Filter;
<span class="s0">import </span>android.widget.ImageView;
<span class="s0">import </span>android.widget.TextView;

<span class="s0">import </span>androidx.appcompat.app.AppCompatActivity;
<span class="s0">import </span>androidx.appcompat.widget.ActionMenuView;
<span class="s0">import </span>androidx.appcompat.widget.PopupMenu;
<span class="s0">import </span>androidx.cardview.widget.CardView;

<span class="s0">import </span>com.google.android.material.button.MaterialButton;
<span class="s0">import </span>com.google.android.material.textfield.TextInputLayout;

<span class="s0">import </span>java.sql.Connection;
<span class="s0">import </span>java.sql.ResultSet;
<span class="s0">import </span>java.sql.SQLException;
<span class="s0">import </span>java.sql.Statement;
<span class="s0">import </span>java.util.ArrayList;
<span class="s0">import </span>java.util.Timer;
<span class="s0">import </span>java.util.TimerTask;

<span class="s0">public class </span>MenuActivity <span class="s0">extends </span>AppCompatActivity {
    SqlConnection connection;
    TextView textTask, textWarehouse;
    Timer timer;
    MaterialButton settingButton;
    EditText ip_Text, username_Text, password_Text;
    Dialog dialog;
    ImageView logo_image;
    CardView card_view, search_cardView, testCard, warehouseCard;
    Connection con;
    Statement statement;
    <span class="s0">int </span>number_tasks = <span class="s2">0</span>;
    <span class="s0">int </span>x;
    ArrayAdapter&lt;String&gt; adapter;

    ArrayList&lt;String&gt; listOfDatabases;
    AutoCompleteTextView editTextFilledExposedDropdown;
  TextInputLayout inputLayout;


    @SuppressLint(<span class="s3">&quot;WrongThread&quot;</span>)
    @Override
    <span class="s0">protected void </span>onCreate(Bundle savedInstanceState) {
        <span class="s0">super</span>.onCreate(savedInstanceState);

        setContentView(R.layout.activity_menu);

        <span class="s0">if </span>(Build.VERSION.SDK_INT &gt;= <span class="s2">19 </span>&amp;&amp; Build.VERSION.SDK_INT &lt; <span class="s2">21</span>) {
            setWindowFlag(<span class="s0">this</span>, WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS, <span class="s0">true</span>);
        }
        <span class="s0">if </span>(Build.VERSION.SDK_INT &gt;= <span class="s2">19</span>) {
            getWindow().getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);
        }
        <span class="s4">//make fully Android Transparent Status bar</span>
        <span class="s0">if </span>(Build.VERSION.SDK_INT &gt;= <span class="s2">21</span>) {
            setWindowFlag(<span class="s0">this</span>, WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS, <span class="s0">false</span>);
            getWindow().setStatusBarColor(Color.TRANSPARENT);
        }

        dialog = <span class="s0">new </span>Dialog(MenuActivity.<span class="s0">this</span>);
        logo_image = findViewById(R.id.logo);
        testCard = findViewById(R.id.testCard);

        listOfDatabases = <span class="s0">new </span>ArrayList&lt;&gt;();
        textTask = (TextView) findViewById(R.id.text_task);
        textWarehouse = findViewById(R.id.text_warehouse);

        adapter = <span class="s0">new </span>ArrayAdapter&lt;&gt;(getApplicationContext(), R.layout.dropdown_menu_popup_item, listOfDatabases);


        settingButton = (MaterialButton) findViewById(R.id.setting_button);


        connection = <span class="s0">new </span>SqlConnection();
        ip_Text = dialog.findViewById(R.id.ip_editText);
        settingButton.setOnClickListener(<span class="s0">new </span>View.OnClickListener() {
            @Override
            <span class="s0">public void </span>onClick(View v) {

                timer.cancel();
                timer.purge();
                dialog.setContentView(R.layout.dialog_setting);
                dialog.getWindow().setBackgroundDrawable(<span class="s0">new </span>ColorDrawable(Color.TRANSPARENT));
                dialog.setCanceledOnTouchOutside(<span class="s0">false</span>);
                dialog.setCancelable(<span class="s0">true</span>);
                editTextFilledExposedDropdown = dialog.findViewById(R.id.filled_exposed_dropdown);
                editTextFilledExposedDropdown.setAdapter(adapter);




                ip_Text = dialog.findViewById(R.id.ip_editText);
                username_Text = dialog.findViewById(R.id.username_editText);
                password_Text = dialog.findViewById(R.id.password_editText);
                ip_Text.setText(SqlConnection.ip);
               <span class="s4">// editTextFilledExposedDropdown.setText(SqlConnection.db);</span>
                username_Text.setText(SqlConnection.un);
                password_Text.setText(SqlConnection.password);

                dialog.show();


            }
        });
        card_view = findViewById(R.id.TaskWorkerCard);
        card_view.setOnClickListener(<span class="s0">new </span>View.OnClickListener() {
            @Override
            <span class="s0">public void </span>onClick(View v) {

                <span class="s0">if </span>(x == <span class="s2">0</span>) {
                    Intent intent = <span class="s0">new </span>Intent(getApplicationContext(), WorkerTaskActivity.<span class="s0">class</span>);
                    startActivity(intent);
                    x++;

                }
            }
        });
        search_cardView = findViewById(R.id.SearchCard);
        search_cardView.setOnClickListener(v -&gt; {

            <span class="s0">if </span>(x == <span class="s2">0</span>) {
                Intent intent = <span class="s0">new </span>Intent(getApplicationContext(), SearchActivity.<span class="s0">class</span>);
                startActivity(intent);
                x++;
            }
        });

        testCard.setOnClickListener(<span class="s0">new </span>View.OnClickListener() {
            @Override
            <span class="s0">public void </span>onClick(View v) {
                <span class="s0">if </span>(x == <span class="s2">0</span>) {
                    Intent intent = <span class="s0">new </span>Intent(getApplicationContext(), ScanOccpancy.<span class="s0">class</span>);
                    startActivity(intent);
                    x++;
                }
            }
        });

        warehouseCard = findViewById(R.id.WarehouseCard);
        warehouseCard.setOnClickListener(<span class="s0">new </span>View.OnClickListener() {
            @Override
            <span class="s0">public void </span>onClick(View v) {
                <span class="s0">if </span>(x == <span class="s2">0</span>) {
                    Intent intent = <span class="s0">new </span>Intent(getApplicationContext(), WarehouseActivity.<span class="s0">class</span>);
                    startActivity(intent);
                    x++;
                }
            }
        });

    }


    @Override
    <span class="s0">protected void </span>onPostResume() {
        <span class="s0">super</span>.onPostResume();
        x = <span class="s2">0</span>;
        textTask.setText(<span class="s2">0 </span>+ <span class="s3">&quot;&quot;</span>);
        textWarehouse.setText(<span class="s2">0 </span>+ <span class="s3">&quot;&quot;</span>);
        timer = <span class="s0">new </span>Timer();
        timer.schedule(<span class="s0">new </span>TimerTask() {
            <span class="s0">public void </span>run() {
                <span class="s0">new </span>getData().execute();
            }
        }, <span class="s2">0</span>, <span class="s2">1000</span>);
    }

    @Override
    <span class="s0">protected void </span>onPause() {
        timer.cancel();
        timer.purge();
        Log.i(<span class="s3">&quot;Pause&quot;</span>, <span class="s3">&quot;Pause&quot;</span>);

        <span class="s0">super</span>.onPause();
    }


    @Override
    <span class="s0">protected void </span>onStop() {
        timer.cancel();
        timer.purge();

        <span class="s0">super</span>.onStop();
    }

    <span class="s0">public static void </span>setWindowFlag(Activity activity, <span class="s0">final int </span>bits, <span class="s0">boolean </span>on) {

        Window win = activity.getWindow();
        WindowManager.LayoutParams winParams = win.getAttributes();
        <span class="s0">if </span>(on) {
            winParams.flags |= bits;
        } <span class="s0">else </span>{
            winParams.flags &amp;= ~bits;
        }
        win.setAttributes(winParams);
    }

    <span class="s0">public class </span>getData <span class="s0">extends </span>AsyncTask&lt;Void, Void, Void&gt; {
        <span class="s0">int </span>number_tasks, warehouse;

        <span class="s0">public </span>getData()
        {
            number_tasks = <span class="s2">0</span>;
            warehouse = <span class="s2">0</span>;
        }

        @Override
        <span class="s0">protected void </span>onPostExecute(Void aVoid) {
            <span class="s0">super</span>.onPostExecute(aVoid);

            textTask.setText(number_tasks + <span class="s3">&quot;&quot;</span>);
            textWarehouse.setText(warehouse + <span class="s3">&quot;&quot;</span>);
        }

        @Override
        <span class="s0">protected </span>Void doInBackground(Void... voids) {

            <span class="s0">try </span>{

                <span class="s0">if </span>(!con.isClosed()) {
                    statement = con.createStatement();
                    number_tasks = getNumberTasks();
                    warehouse = getConditionWarehouse(<span class="s2">0</span>);

                } <span class="s0">else </span>{
                    number_tasks = <span class="s2">0</span>;
                    warehouse = <span class="s2">0</span>;
                }
                con.close();


            } <span class="s0">catch </span>(Exception e) {
                e.printStackTrace();

            }

            <span class="s0">return null</span>;
        }

        @Override
        <span class="s0">protected void </span>onPreExecute() {
            <span class="s0">super</span>.onPreExecute();
            <span class="s0">try </span>{
                con = connection.CONN();

            } <span class="s0">catch </span>(Exception e) {
                e.printStackTrace();

            }

        }
    }

    <span class="s0">public int </span>getNumberTasks() {

        <span class="s0">try </span>{
            number_tasks = <span class="s2">0</span>;
            ResultSet rs = <span class="s0">null</span>;
            rs = statement.executeQuery(<span class="s3">&quot;select</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;CZN_NrPelny as [Numer Zlecenia]</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;from dbo.CtiZlecenieNag</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;right join dbo.CtiZlecenieZasob on CZN_ID = ZZs_CZNID where ZZs_DataDo is NULL&quot;</span>);
            <span class="s0">while </span>(rs.next()) {
                number_tasks++;
            }
        } <span class="s0">catch </span>(SQLException e) {
            e.printStackTrace();
            number_tasks = <span class="s2">0</span>;
        }
        <span class="s0">return </span>number_tasks;
    }

    <span class="s0">public int </span>getConditionWarehouse(<span class="s0">int </span>warehouseId) {
        <span class="s0">int </span>warehouseCondition = <span class="s2">0</span>;

        ResultSet rs = <span class="s0">null</span>;
        <span class="s0">try </span>{
            rs = statement.executeQuery(<span class="s3">&quot;SELECT Twr_Kod, TwI_Ilosc , Twr_IloscMin, TwI_MagId from Cdn.TwrIlosci A</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;JOIN (</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;SELECT X.twi_data AS DATA, X.twi_twiid AS Twiid</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;FROM cdn.twrilosci X where X.twi_twiid = CDN.TwrIlosciID ( X.twi_twrid,&quot; </span>+ warehouseId + <span class="s3">&quot;, getdate())</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;) B ON A.TwI_TwIId = B.Twiid</span><span class="s0">\n</span><span class="s3">&quot; </span>+
                    <span class="s3">&quot;JOIN cdn.towary on a.twi_twrid = Twr_TwrId AND TwI_Ilosc &lt; Twr_IloscMin&quot;</span>);
            <span class="s0">while </span>(rs.next()) {
                warehouseCondition++;
            }
        } <span class="s0">catch </span>(SQLException e) {
            e.printStackTrace();
        }
        <span class="s0">return </span>warehouseCondition;
    }

    <span class="s0">public void </span>setSettings(View v) <span class="s0">throws </span>SQLException {

        SqlConnection.ip = ip_Text.getText() + <span class="s3">&quot;&quot;</span>;
        SqlConnection.db = editTextFilledExposedDropdown.getText().toString();
        SqlConnection.un = username_Text.getText() + <span class="s3">&quot;&quot;</span>;
        SqlConnection.password = password_Text.getText() + <span class="s3">&quot;&quot;</span>;
        saveSettings(SqlConnection.ip, SqlConnection.db, SqlConnection.un, SqlConnection.password);
        timer = <span class="s0">new </span>Timer();
        timer.schedule(<span class="s0">new </span>TimerTask() {
            <span class="s0">public void </span>run() {
                <span class="s0">new </span>getData().execute();
            }
        }, <span class="s2">0</span>, <span class="s2">2000</span>);
        dialog.dismiss();
    }

    <span class="s0">public void </span>saveSettings(String ip, String database, String usersname, String password) {
        SharedPreferences sharedPref = <span class="s0">this</span>.getSharedPreferences(<span class="s3">&quot;general_setting&quot;</span>, Context.MODE_PRIVATE);
        Log.i(<span class="s3">&quot;Zapis&quot;</span>, sharedPref + <span class="s3">&quot;&quot;</span>);
        SharedPreferences.Editor editor = sharedPref.edit();
        editor.putString(ip, <span class="s3">&quot;ipData&quot;</span>);
        editor.putString(database, <span class="s3">&quot;databaseData&quot;</span>);
        editor.putString(usersname, <span class="s3">&quot;usernameData&quot;</span>);
        editor.putString(password, <span class="s3">&quot;passwordData&quot;</span>);
        editor.commit();

    }



    <span class="s0">public class </span>LoadingListDatabases <span class="s0">extends </span>AsyncTask&lt;Void, Void, Void&gt; {

        ArrayList&lt;String&gt; tempArraydatabese;
        @Override
        <span class="s0">protected </span>Void doInBackground(Void... voids) {

            SqlConnection connection = <span class="s0">new </span>SqlConnection();
            Connection con = connection.CONN();
            tempArraydatabese = <span class="s0">new </span>ArrayList&lt;&gt;();

            <span class="s0">if </span>(con != <span class="s0">null</span>) {
                <span class="s0">try </span>{
                    Statement statement = <span class="s0">null</span>;
                    statement = con.createStatement();
                    ResultSet rs = <span class="s0">null</span>;
                    listOfDatabases.clear();
                    rs = statement.executeQuery(<span class="s3">&quot;SELECT name FROM master.sys.databases&quot;</span>);

                    <span class="s0">while </span>(rs.next()) {
                        listOfDatabases.add(rs.getString(<span class="s2">1</span>));


                    }
                    Log.i(<span class="s3">&quot;Licznik&quot;</span>, listOfDatabases.size()+<span class="s3">&quot;&quot;</span>);
                    con.close();

                } <span class="s0">catch </span>(Exception e) {
                    e.printStackTrace();
                }
            }



            <span class="s0">return null</span>;
        }

        @Override
        <span class="s0">protected void </span>onPreExecute() {
            <span class="s0">super</span>.onPreExecute();

            SqlConnection.ip = ip_Text.getText().toString();
            SqlConnection.password = password_Text.getText().toString();
            SqlConnection.un = username_Text.getText().toString();







        }

        @Override
        <span class="s0">protected void </span>onPostExecute(Void aVoid) {

            <span class="s0">super</span>.onPostExecute(aVoid);








        }

        @Override
        <span class="s0">protected void </span>onProgressUpdate(Void... values) {
            <span class="s0">super</span>.onProgressUpdate(values);

        }
    }

}







</pre>
</body>
</html>