<html>
<head>
<title>ScanOccpancy.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #0000ff;}
.s3 { color: #008000; font-weight: bold;}
.s4 { color: #808080; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ScanOccpancy.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span>com.example.myapplication;

<span class="s0">import </span>android.content.Context;
<span class="s0">import </span>android.content.pm.PackageInfo;
<span class="s0">import </span>android.content.pm.PackageManager;

<span class="s0">import </span>android.graphics.Color;
<span class="s0">import </span>android.os.Bundle;
<span class="s0">import </span>android.util.Log;
<span class="s0">import </span>android.widget.CompoundButton;


<span class="s0">import </span>androidx.appcompat.app.AppCompatActivity;
<span class="s0">import </span>androidx.core.app.ActivityCompat;
<span class="s0">import </span>androidx.core.content.ContextCompat;

<span class="s0">import </span>java.io.IOException;
<span class="s0">import </span>java.sql.Connection;
<span class="s0">import </span>java.sql.PreparedStatement;
<span class="s0">import </span>java.sql.ResultSet;
<span class="s0">import </span>java.sql.SQLException;
<span class="s0">import </span>java.sql.SQLTimeoutException;
<span class="s0">import </span>java.sql.Statement;
<span class="s0">import </span>java.util.ArrayList;
<span class="s0">import </span>java.util.List;
<span class="s0">import </span>java.util.concurrent.TimeoutException;

<span class="s0">public class </span>ScanOccpancy <span class="s0">extends </span>AppCompatActivity <span class="s0">implements</span>
        CompoundButton.OnCheckedChangeListener {
    <span class="s0">private static final int </span>PERMISSION_REQUESTS = <span class="s2">1</span>;
    <span class="s0">private </span>CameraSource cameraSource = <span class="s0">null</span>;
    <span class="s0">private </span>CameraSourcePreview preview;
    <span class="s0">private </span>GraphicOverlay graphicOverlay;
    <span class="s0">private static final </span>String TAG = <span class="s3">&quot;Barcode Scanning&quot;</span>;
    <span class="s0">private </span>SqlConnection connection;
    <span class="s0">private </span>Connection con;
    <span class="s0">private </span>ArrayList&lt;String&gt; listOf;


    @Override
    <span class="s0">protected void </span>onCreate(Bundle savedInstanceState) {
        <span class="s0">super</span>.onCreate(savedInstanceState);
        connection = <span class="s0">new </span>SqlConnection();
        setContentView(R.layout.activity_main);
        preview = findViewById(R.id.firePreview);
        graphicOverlay = findViewById(R.id.fireFaceOverlay);
        listOf = <span class="s0">new </span>ArrayList&lt;&gt;();
        getWindow().setStatusBarColor(Color.parseColor(<span class="s3">&quot;#03a9f4&quot;</span>));
        <span class="s0">try </span>{
            getArray();
        } <span class="s0">catch </span>(Exception e) {
            e.getMessage();
        }


        <span class="s0">if </span>(allPermissionsGranted()) {
            createCameraSource();
            startCameraSource();
        } <span class="s0">else </span>{
            getRuntimePermissions();
        }

    }

    @Override
    <span class="s0">public void </span>onCheckedChanged(CompoundButton buttonView, <span class="s0">boolean </span>isChecked) {
        <span class="s0">if </span>(cameraSource != <span class="s0">null</span>) {
            <span class="s0">if </span>(isChecked) {
                cameraSource.setFacing(CameraSource.CAMERA_FACING_FRONT);
            } <span class="s0">else </span>{
                cameraSource.setFacing(CameraSource.CAMERA_FACING_BACK);
            }
        }
        preview.stop();
        startCameraSource();
    }

    <span class="s0">private void </span>createCameraSource() {
        <span class="s4">// If there's no existing cameraSource, create one.</span>
        <span class="s0">if </span>(cameraSource == <span class="s0">null</span>) {
            cameraSource = <span class="s0">new </span>CameraSource(<span class="s0">this</span>, graphicOverlay);
        }

        cameraSource.setMachineLearningFrameProcessor(<span class="s0">new </span>BarcodeScanningProcessor(listOf));

    }

    <span class="s4">/**</span>
     <span class="s4">* Starts or restarts the camera source, if it exists. If the camera source doesn't exist yet</span>
     <span class="s4">* (e.g., because onResume was called before the camera source was created), this will be called</span>
     <span class="s4">* again when the camera source is created.</span>
     <span class="s4">*/</span>
    <span class="s0">private void </span>startCameraSource() {
        <span class="s0">if </span>(cameraSource != <span class="s0">null</span>) {
            <span class="s0">try </span>{
                <span class="s0">if </span>(preview == <span class="s0">null</span>) {
                    Log.d(TAG, <span class="s3">&quot;resume: Preview is null&quot;</span>);
                }
                <span class="s0">if </span>(graphicOverlay == <span class="s0">null</span>) {
                    Log.d(TAG, <span class="s3">&quot;resume: graphOverlay is null&quot;</span>);
                }
                preview.start(cameraSource, graphicOverlay);
            } <span class="s0">catch </span>(IOException e) {
                cameraSource.release();
                cameraSource = <span class="s0">null</span>;
            }
        }
    }

    @Override
    <span class="s0">public void </span>onResume() {
        <span class="s0">super</span>.onResume();
        startCameraSource();
    }

    <span class="s4">/**</span>
     <span class="s4">* Stops the camera.</span>
     <span class="s4">*/</span>
    @Override
    <span class="s0">protected void </span>onPause() {
        <span class="s0">super</span>.onPause();
        preview.stop();
    }

    @Override
    <span class="s0">public void </span>onDestroy() {
        <span class="s0">super</span>.onDestroy();
        <span class="s0">if </span>(cameraSource != <span class="s0">null</span>) {
            cameraSource.release();
        }
    }

    <span class="s0">private boolean </span>allPermissionsGranted() {
        <span class="s0">for </span>(String permission : getRequiredPermissions()) {
            <span class="s0">if </span>(!isPermissionGranted(<span class="s0">this</span>, permission)) {
                <span class="s0">return false</span>;
            }
        }
        <span class="s0">return true</span>;
    }

    <span class="s0">private void </span>getRuntimePermissions() {
        List allNeededPermissions = <span class="s0">new </span>ArrayList&lt;&gt;();
        <span class="s0">for </span>(String permission : getRequiredPermissions()) {
            <span class="s0">if </span>(!isPermissionGranted(<span class="s0">this</span>, permission)) {
                allNeededPermissions.add(permission);
            }
        }

        <span class="s0">if </span>(!allNeededPermissions.isEmpty()) {
            ActivityCompat.requestPermissions(
                    <span class="s0">this</span>, (String[]) allNeededPermissions.toArray(<span class="s0">new </span>String[<span class="s2">0</span>]), PERMISSION_REQUESTS);
        }
    }

    <span class="s0">private </span>String[] getRequiredPermissions() {
        <span class="s0">try </span>{
            PackageInfo info =
                    <span class="s0">this</span>.getPackageManager()
                            .getPackageInfo(<span class="s0">this</span>.getPackageName(), PackageManager.GET_PERMISSIONS);
            String[] ps = info.requestedPermissions;
            <span class="s0">if </span>(ps != <span class="s0">null </span>&amp;&amp; ps.length &gt; <span class="s2">0</span>) {
                <span class="s0">return </span>ps;
            } <span class="s0">else </span>{
                <span class="s0">return new </span>String[<span class="s2">0</span>];
            }
        } <span class="s0">catch </span>(Exception e) {
            <span class="s0">return new </span>String[<span class="s2">0</span>];
        }
    }

    @Override
    <span class="s0">public void </span>onRequestPermissionsResult(
            <span class="s0">int </span>requestCode, String[] permissions, <span class="s0">int</span>[] grantResults) {
        <span class="s0">if </span>(allPermissionsGranted()) {
            createCameraSource();
            startCameraSource();
        }
        <span class="s0">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);
    }

    <span class="s0">private static boolean </span>isPermissionGranted(Context context, String permission) {
        <span class="s0">if </span>(ContextCompat.checkSelfPermission(context, permission)
                == PackageManager.PERMISSION_GRANTED) {
            <span class="s0">return true</span>;
        }
        <span class="s0">return false</span>;
    }

    <span class="s0">public void </span>getArray() <span class="s0">throws </span>Exception {

        con = connection.CONN();

        <span class="s0">if </span>(con != <span class="s0">null</span>) {
            Statement statement = <span class="s0">null</span>;
            ResultSet rs = <span class="s0">null</span>;
            <span class="s0">try </span>{
                statement = con.createStatement();
                rs = statement.executeQuery(<span class="s3">&quot;select * from CDN.TraNag&quot;</span>);
                <span class="s0">while </span>(rs.next()) {
                    listOf.add(rs.getString(<span class="s2">1</span>));
                    Log.i(<span class="s3">&quot;Rozmiar tablicy 2&quot;</span>, listOf.size() + <span class="s3">&quot;&quot;</span>);
                    Log.i(<span class="s3">&quot;Czas&quot;</span>, statement.getQueryTimeout() + <span class="s3">&quot;&quot;</span>);
                }

            } <span class="s0">catch </span>(SQLException e) {
                e.printStackTrace();

            }

            con.close();
        }
    }
}







</pre>
</body>
</html>